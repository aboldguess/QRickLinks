{% extends 'base.html' %}
{% block content %}
<h2>Pricing</h2>
<div class="text-center mb-3">
  <div class="btn-group" role="group" aria-label="Billing toggle">
    <input class="btn-check" type="radio" name="billing" id="billingMonthly" autocomplete="off" checked>
    <label class="btn btn-outline-primary" for="billingMonthly">Monthly</label>
    <input class="btn-check" type="radio" name="billing" id="billingYearly" autocomplete="off">
    <label class="btn btn-outline-primary" for="billingYearly">Yearly</label>
  </div>
</div>
<table class="table table-bordered text-center">
  <thead>
    <tr>
      <th>Plan</th>
      {% for tier in tiers %}
      <th>
        {{ tier.name }}
        {% if tier.highlight_text %}<div class="text-muted">{{ tier.highlight_text }}</div>{% endif %}
      </th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Price Per Month</th>
      {% for tier in tiers %}
      <td class="price-cell" data-monthly="{{ tier.monthly_price }}" data-yearly="{{ tier.yearly_price }}"></td>
      {% endfor %}
    </tr>
    {% for feat in features %}
    <tr>
      <th>{{ feat.replace('_',' ').title() }}</th>
      {% for tier in tiers %}
      <td>
        {% if getattr(tier, feat + '_unlimited') %}Unlimited{% else %}{{ getattr(tier, feat + '_limit') }}{% endif %}
      </td>
      {% endfor %}
    </tr>
    {% endfor %}
    <tr>
      <th>Total Cost Today</th>
      {% for tier in tiers %}
      <td class="total-cell" data-monthly="{{ tier.monthly_price }}" data-yearly="{{ tier.yearly_price }}"></td>
      {% endfor %}
    </tr>
  </tbody>
</table>
{% if current_user.is_authenticated and not current_user.is_premium %}
<a class="btn btn-primary" href="{{ url_for('subscribe') }}">Subscribe</a>
{% endif %}
<script>
function updatePrices() {
  const yearly = document.getElementById('billingYearly').checked;
  document.querySelectorAll('.price-cell').forEach(cell => {
    const monthly = parseFloat(cell.dataset.monthly || 0);
    const yearlyPrice = parseFloat(cell.dataset.yearly || 0);
    const perMonth = yearly ? yearlyPrice / 12 : monthly;
    cell.textContent = `$${perMonth.toFixed(2)} / mo`;
  });
  document.querySelectorAll('.total-cell').forEach(cell => {
    const monthly = parseFloat(cell.dataset.monthly || 0);
    const yearlyPrice = parseFloat(cell.dataset.yearly || 0);
    cell.textContent = yearly ? `$${yearlyPrice.toFixed(2)}` : `$${monthly.toFixed(2)}`;
  });
}
document.querySelectorAll('input[name="billing"]').forEach(el => {
  el.addEventListener('change', updatePrices);
});
updatePrices();
</script>
{% endblock %}
